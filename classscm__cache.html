<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>SCM Library: scm_cache Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SCM Library
   </div>
   <div id="projectbrief">Spherical Cube Map rendering library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classscm__cache-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">scm_cache Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>An <a class="el" href="classscm__cache.html" title="An scm_cache is a virtual texture, demand-paged with threaded data access, represented as a single la...">scm_cache</a> is a virtual texture, demand-paged with threaded data access, represented as a single large OpenGL texture atlas.  
 <a href="classscm__cache.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="scm-cache_8hpp_source.html">scm-cache.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:abe0c5fa04d1939c1ea74972cf2035d0a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#abe0c5fa04d1939c1ea74972cf2035d0a">scm_cache</a> (<a class="el" href="classscm__system.html">scm_system</a> *, int, int, int)</td></tr>
<tr class="memdesc:abe0c5fa04d1939c1ea74972cf2035d0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new page cache with a queue for making page requests.  <a href="#abe0c5fa04d1939c1ea74972cf2035d0a">More...</a><br/></td></tr>
<tr class="separator:abe0c5fa04d1939c1ea74972cf2035d0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e764ad262d9f68f2e5328e6ac922de8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4e764ad262d9f68f2e5328e6ac922de8"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#a4e764ad262d9f68f2e5328e6ac922de8">~scm_cache</a> ()</td></tr>
<tr class="memdesc:a4e764ad262d9f68f2e5328e6ac922de8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy a page cache and finalize all OpenGL state. <br/></td></tr>
<tr class="separator:a4e764ad262d9f68f2e5328e6ac922de8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a640dbd3b511fecfbb76f787e4b718d97"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a640dbd3b511fecfbb76f787e4b718d97"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#a640dbd3b511fecfbb76f787e4b718d97">add_load</a> (<a class="el" href="structscm__task.html">scm_task</a> &amp;)</td></tr>
<tr class="memdesc:a640dbd3b511fecfbb76f787e4b718d97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a page request to the load queue. <br/></td></tr>
<tr class="separator:a640dbd3b511fecfbb76f787e4b718d97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58ecd94f6aff86e4f1ddfa8b5efdfffa"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a58ecd94f6aff86e4f1ddfa8b5efdfffa"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>get_grid_size</b> () const </td></tr>
<tr class="separator:a58ecd94f6aff86e4f1ddfa8b5efdfffa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a993945aba25bf1e7f5c51b81ff667437"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a993945aba25bf1e7f5c51b81ff667437"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>get_page_size</b> () const </td></tr>
<tr class="separator:a993945aba25bf1e7f5c51b81ff667437"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fe35609793088a2daa74582442a7b0a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0fe35609793088a2daa74582442a7b0a"></a>
GLuint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#a0fe35609793088a2daa74582442a7b0a">get_texture</a> () const </td></tr>
<tr class="memdesc:a0fe35609793088a2daa74582442a7b0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the OpenGL texture object representing the cache. <br/></td></tr>
<tr class="separator:a0fe35609793088a2daa74582442a7b0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17052560e96e30da2b54acc569270b64"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#a17052560e96e30da2b54acc569270b64">get_page</a> (int, long long, int, int &amp;)</td></tr>
<tr class="memdesc:a17052560e96e30da2b54acc569270b64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the cache line of a loaded page.  <a href="#a17052560e96e30da2b54acc569270b64">More...</a><br/></td></tr>
<tr class="separator:a17052560e96e30da2b54acc569270b64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb8e199fba2153d0955df5a3ecc706dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#abb8e199fba2153d0955df5a3ecc706dd">update</a> (int, bool)</td></tr>
<tr class="memdesc:abb8e199fba2153d0955df5a3ecc706dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle incoming textures on the loads queue, copying them to the atlas.  <a href="#abb8e199fba2153d0955df5a3ecc706dd">More...</a><br/></td></tr>
<tr class="separator:abb8e199fba2153d0955df5a3ecc706dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7cd9809cca515f64ce67d848704342f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#af7cd9809cca515f64ce67d848704342f">render</a> (int, int)</td></tr>
<tr class="memdesc:af7cd9809cca515f64ce67d848704342f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Render a 2D overlay of the contents of all caches.  <a href="#af7cd9809cca515f64ce67d848704342f">More...</a><br/></td></tr>
<tr class="separator:af7cd9809cca515f64ce67d848704342f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a524f26ed7fb16c343d1c34bcce63088f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#a524f26ed7fb16c343d1c34bcce63088f">flush</a> ()</td></tr>
<tr class="memdesc:a524f26ed7fb16c343d1c34bcce63088f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Eject all pages.  <a href="#a524f26ed7fb16c343d1c34bcce63088f">More...</a><br/></td></tr>
<tr class="separator:a524f26ed7fb16c343d1c34bcce63088f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:ae5b28eaba1d8b11907e83a86b63d43c3"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae5b28eaba1d8b11907e83a86b63d43c3"></a>
static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#ae5b28eaba1d8b11907e83a86b63d43c3">cache_size</a> = 16</td></tr>
<tr class="memdesc:ae5b28eaba1d8b11907e83a86b63d43c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">The cache grid size. The texture atlas will have size N x N where N = grid_size * page_size. Too large a value may exceed the maximum texture size or available VRAM, resulting in peer performance. Too small a value may result in poor image quality and unnecessary data traffic. <br/></td></tr>
<tr class="separator:ae5b28eaba1d8b11907e83a86b63d43c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a1dd4b8af530ce0c7fff300ce80f21a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3a1dd4b8af530ce0c7fff300ce80f21a"></a>
static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#a3a1dd4b8af530ce0c7fff300ce80f21a">cache_threads</a> = 2</td></tr>
<tr class="memdesc:a3a1dd4b8af530ce0c7fff300ce80f21a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of loader threads servicing page load requests for each cache. <br/></td></tr>
<tr class="separator:a3a1dd4b8af530ce0c7fff300ce80f21a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a510000fd2b3537abb3c50007f7cdce49"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a510000fd2b3537abb3c50007f7cdce49"></a>
static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#a510000fd2b3537abb3c50007f7cdce49">need_queue_size</a> = 32</td></tr>
<tr class="memdesc:a510000fd2b3537abb3c50007f7cdce49"><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximum number of page load requests allowed at any moment. (Requests from the render thread to the loader threads.) If this limit is exceeded the render thread will abandon the request and repeat it later. <br/></td></tr>
<tr class="separator:a510000fd2b3537abb3c50007f7cdce49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac976510087ffea150c792112e0acfd37"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac976510087ffea150c792112e0acfd37"></a>
static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#ac976510087ffea150c792112e0acfd37">load_queue_size</a> = 8</td></tr>
<tr class="memdesc:ac976510087ffea150c792112e0acfd37"><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximum number of page load results allowed at any moment. (Results from the loader threads to the render thread.) If this limit is exceeded the loader thread will block on load queue. <br/></td></tr>
<tr class="separator:ac976510087ffea150c792112e0acfd37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a369e01756cf83406584d443dd62f5c56"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a369e01756cf83406584d443dd62f5c56"></a>
static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscm__cache.html#a369e01756cf83406584d443dd62f5c56">loads_per_cycle</a> = 2</td></tr>
<tr class="memdesc:a369e01756cf83406584d443dd62f5c56"><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximum number of page load results that may be uploaded to the atlas by the render thread each frame. A large value may impact frame rate. A small value may increase frame latency and/or block the loader threads. <br/></td></tr>
<tr class="separator:a369e01756cf83406584d443dd62f5c56"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>An <a class="el" href="classscm__cache.html" title="An scm_cache is a virtual texture, demand-paged with threaded data access, represented as a single la...">scm_cache</a> is a virtual texture, demand-paged with threaded data access, represented as a single large OpenGL texture atlas. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="abe0c5fa04d1939c1ea74972cf2035d0a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scm_cache::scm_cache </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classscm__system.html">scm_system</a> *&#160;</td>
          <td class="paramname"><em>sys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new page cache with a queue for making page requests. </p>
<p>Initialize all OpenGL state including the texture atlas and a ring of pixel buffer objects for use in asynchronous upload of page data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sys</td><td>SCM system </td></tr>
    <tr><td class="paramname">n</td><td>Page size in pixels </td></tr>
    <tr><td class="paramname">c</td><td>Channels per pixel </td></tr>
    <tr><td class="paramname">b</td><td>Bits per channel </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a17052560e96e30da2b54acc569270b64"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int scm_cache::get_page </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>u</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the cache line of a loaded page. </p>
<p>Cache lines are indexed from left to right and top to bottom. Request the page if necessary. Return 0 if the page is not available (line 0 is always transparent blank and will thus appear invisible).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f</td><td>File index </td></tr>
    <tr><td class="paramname">i</td><td>Page index </td></tr>
    <tr><td class="paramname">t</td><td>Current time </td></tr>
    <tr><td class="paramname">u</td><td>Time at which the page was loaded. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="abb8e199fba2153d0955df5a3ecc706dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scm_cache::update </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle incoming textures on the loads queue, copying them to the atlas. </p>
<p>This should be called by the render thread every frame. If invoked with the synchronous flag, loop until all page requests in the load queue are handled.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Current time </td></tr>
    <tr><td class="paramname">b</td><td>Synchronous? </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="af7cd9809cca515f64ce67d848704342f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scm_cache::render </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ii</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Render a 2D overlay of the contents of all caches. </p>
<p>The parameters are used to format an optimal on-screen array of caches.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ii</td><td>Cache index </td></tr>
    <tr><td class="paramname">nn</td><td>Cache count </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a524f26ed7fb16c343d1c34bcce63088f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scm_cache::flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Eject all pages. </p>
<p>All page requests in the load queue remain, so a flush is unlikely to be 100% effective unless performed directly after a synchronous update. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="scm-cache_8hpp_source.html">scm-cache.hpp</a></li>
<li>scm-cache.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 23 2014 13:40:58 for SCM Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
